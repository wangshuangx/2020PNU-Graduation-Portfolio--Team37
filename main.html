

<!--
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 4 & Angular 8
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Dribbble: www.dribbble.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
Renew Support: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<html lang="zh-cn">

    <!-- begin::Head -->
    <head>
        {include file="public/header" title="Dashboard" /}
        <link href="//www.amcharts.com/lib/3/plugins/export/export.css?v=7.1.0" rel="stylesheet" type="text/css" />
        <style>
            .alert-text{
                font-size:16px;
            }
        </style>
    </head>

    <!-- end::Head -->

    <!-- begin::Body -->
    <body style="background-image: url(/static/admin/media/demos/demo4/header.jpg); background-position: center top; background-size: 100% 350px;" class="kt-page--loading-enabled kt-page--loading kt-page--fluid kt-quick-panel--right kt-demo-panel--right kt-offcanvas-panel--right kt-header--fixed kt-header--minimize-menu kt-header-mobile--fixed kt-subheader--enabled kt-subheader--transparent kt-page--loading">

        <!-- begin::Page loader -->

        <!-- end::Page Loader -->

        <!-- begin:: Page -->

        <!-- begin:: Header Mobile -->
        {include file="public/header_mobile"  /}

        <!-- end:: Header Mobile -->
        <div class="kt-grid kt-grid--hor kt-grid--root">
            <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--ver kt-page">
                <div class="kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-wrapper" id="kt_wrapper">

                    <!-- begin:: Header -->
                    <div id="kt_header" class="kt-header  kt-header--fixed " data-ktheader-minimize="on">
                        <div class="kt-container ">

                            <!-- begin:: Brand -->
                            <div class="kt-header__brand   kt-grid__item" id="kt_header_brand">
                                <a class="kt-header__brand-logo" href="?page=index">
                                    <img alt="Logo" src="/static/admin/media/logos/logo-4.png" class="kt-header__brand-logo-default" />
                                    <img alt="Logo" src="/static/admin/media/logos/logo-4-sm.png" class="kt-header__brand-logo-sticky" />
                                </a>
                            </div>

                            <!-- end:: Brand -->

                            <!-- begin: Header Menu -->
                            {include file="public/menu"  /}
                            <!-- end: Header Menu -->

                            <!-- begin:: Header Topbar -->
                            {include file="public/topbar"  /}
                            <!-- end:: Header Topbar -->
                        </div>
                    </div>

                    <!-- end:: Header -->
                    <div class="kt-body kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-grid--stretch" id="kt_body">
                        <div class="kt-content kt-content--fit-top  kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor" id="kt_content">

                            <!-- begin:: Subheader -->
                            {include file="public/subheader"  title="Dashboard"  page="Dashboard" /}
                            <!-- end:: Subheader -->
                            <!-- begin:: Content -->
                            <div class="kt-container  kt-grid__item kt-grid__item--fluid">

                                <!--begin:: Portlet-->
                                <div class="kt-portlet">

                                    <div class="kt-portlet__body">

                                        <div class="kt-widget kt-widget--user-profile-3">

                                            <div class="kt-widget__top">
                                                <div class="kt-widget__content">
                                                    <div class="kt-widget__head">
                                                        <a href="#" class="kt-widget__username">
                                                            WANG SHUANG XI
                                                            <i class="flaticon2-correct kt-font-success"></i>
                                                        </a>
                                                    </div>
                                                    <div class="kt-widget__subhead">
                                                        <a href="#"><i class="la la-phone"></i>Tel:010-7556-9806</a>
                                                        <a href="#"><i class="la la-user"></i>Age:20 </a>
                                                        <a href="#"><i class="la la-map-marker"></i>Height:178</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="kt-widget__bottom">
                                                <div class="kt-widget__item">
                                                    <div class="kt-widget__icon">
                                                        <i class="flaticon-users"></i>
                                                    </div>
                                                    <div class="kt-widget__details">
                                                        <span class="kt-widget__title">현재 행동</span>
                                                        <span class="kt-widget__value" id="now_action">Waiting...</span>
                                                    </div>
                                                </div>
                                                <div class="kt-widget__item">
                                                    <div class="kt-widget__icon">
                                                        <i class="flaticon-user-ok"></i>
                                                    </div>
                                                    <div class="kt-widget__details">
                                                        <span class="kt-widget__title">위 행동</span>
                                                        <span class="kt-widget__value"  id="last_action">Waiting...</span>
                                                    </div>
                                                </div>
                                                <div class="kt-widget__item">
                                                    <div class="kt-widget__icon">
                                                        <i class="flaticon-pie-chart" style="color:red"></i>
                                                    </div>
                                                    <div class="kt-widget__details">
                                                        <span class="kt-widget__title">오늘의 총 행동</span>
                                                        <span class="kt-widget__value"  id="action_count">Waiting...</span>
                                                    </div>
                                                </div>

                                                <!--<div class="kt-widget__item">
                                                    <div class="kt-widget__icon">
                                                        <i class="flaticon-chat-1"></i>
                                                    </div>
                                                    <div class="kt-widget__details">
                                                        <span class="kt-widget__title">0 举报聚集信息</span>
                                                        <a href="#" class="kt-widget__value kt-font-brand"></a>
                                                    </div>
                                                </div>-->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--end:: Portlet-->
                                <div class="example-preview">
                                    {if $washingHandCount < 5}
                                    <div class="alert alert-custom alert-notice alert-light-primary fade show mb-5" role="alert">
                                        <div class="alert-icon">
                                            <i class="flaticon-warning"></i>
                                        </div>
                                        <div class="alert-text">Wash hands less than 5 times, please wash hands in time. Now is:{$washingHandCount}</div>
                                        <div class="alert-close">
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">
                                                    <i class="fas fa-window-close"></i>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    {/if}
                                    {if $brushingToothCount < 2}
                                    <div class="alert alert-custom alert-notice alert-light-primary fade show mb-5" role="alert">
                                        <div class="alert-icon">
                                            <i class="flaticon-warning"></i>
                                        </div>
                                        <div class="alert-text">You have brushed your teeth less than twice today, don't forget.</div>
                                        <div class="alert-close">
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">
                                                    <i class="fas fa-window-close"></i>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    {/if}

                                <!--begin::Card-->
                                <div class="card card-custom gutter-b">
                                    <div class="card-header" style="background:#fff;color: #181C32;font-size:1.275rem;font-weight: 500;">

                                        <h3 class="card-label pull-left" style="margin-top: 0.5rem;">데이터 통계</h3>

                                        <div class="input-group pull-right" style="width:350px">
                                            <input type="text" class="form-control" id="dateRange" placeholder="根据日期范围查询">
                                            <div class="input-group-append">
                                                <span class="input-group-text" style="border-radius:0"><i class="la la-calendar-check-o"></i></span>
                                            </div>
                                            <button type="button" class="btn btn-brand active" id="dateSelect" style="border-radius:0" >DateSelect</button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div id="chartdiv" style="height: 500px;"></div>
                                    </div>
                                                                        <div class="alert alert-custom alert-notice alert-light-primary fade show mb-5" role="alert">
                                        <div class="alert-icon">
                                            <i class="flaticon-warning"></i>
                                        </div>
                                        <div class="alert-text">Warm reminder: For the sake of your hygiene and health, please remember to wash your hands before dinner and after going out, for about 20 seconds each time.Brush your teeth at least twice a day and drink plenty of water.</div>
                                        <div class="alert-close">
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">
                                                    <i class="fas fa-window-close"></i>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                </div>
                                <!--end::Card-->

                            </div>

                            <!-- end:: Content -->
                        </div>
                    </div>

                    <!-- begin:: Footer -->
                    {include file="public/bottombar"  /}

                    <!-- end:: Footer -->
                </div>
            </div>
        </div>

        <!-- end:: Page -->

        <!-- begin::Quick Panel -->

        <!-- end::Quick Panel -->

        <!-- begin::Scrolltop -->
        <div id="kt_scrolltop" class="kt-scrolltop">
            <i class="fa fa-arrow-up"></i>
        </div>

        <!-- begin::Global Config(global config for global JS sciprts) -->
        <script>
            var KTAppOptions = {
                "colors": {
                    "state": {
                        "brand": "#366cf3",
                        "light": "#ffffff",
                        "dark": "#282a3c",
                        "primary": "#5867dd",
                        "success": "#34bfa3",
                        "info": "#36a3f7",
                        "warning": "#ffb822",
                        "danger": "#fd3995"
                    },
                    "base": {
                        "label": ["#c5cbe3", "#a1a8c3", "#3d4465", "#3e4466"],
                        "shape": ["#f0f3ff", "#d9dffa", "#afb4d4", "#646c9a"]
                    }
                }
            };
        </script>

        <!-- end::Global Config -->

        <!-- Resources -->
        <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
        <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
        <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
        <!--begin::Global Theme Bundle(used by all pages) -->
        <script src="/static/admin/plugins/global/plugins.bundle.js" type="text/javascript"></script>
        <script src="/static/admin/js/scripts.bundle.js" type="text/javascript"></script>

        <!--end::Global Theme Bundle -->

        <!--begin::Page Vendors(used by this page) -->
        <script src="/static/admin/plugins/custom/fullcalendar/fullcalendar.bundle.js" type="text/javascript"></script>

        <script src="/static/admin/plugins/custom/gmaps/gmaps.js" type="text/javascript"></script>

        <!--end::Page Vendors -->
        <!--begin::Page Vendors(used by this page)-->
        <script>
            am4core.ready(function () {

                // Themes begin
                am4core.useTheme(am4themes_animated);
                // Themes end

                var chart = am4core.create("chartdiv", am4charts.XYChart);
                chart.hiddenState.properties.opacity = 0; // this creates initial fade-in



                var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
                categoryAxis.renderer.grid.template.location = 0;
                categoryAxis.dataFields.category = "type";
                categoryAxis.renderer.minGridDistance = 40;
                categoryAxis.fontSize = 11;

                var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
                valueAxis.min = 0;

                valueAxis.strictMinMax = true;
                valueAxis.renderer.minGridDistance = 30;
                // axis break
                var axisBreak = valueAxis.axisBreaks.create();

                //axisBreak.breakSize = 0.005;

                // fixed axis break
                var d = (axisBreak.endValue - axisBreak.startValue) / (valueAxis.max - valueAxis.min);
                axisBreak.breakSize = 0.05 * (1 - d) / d; // 0.05 means that the break will take 5% of the total value axis height

                // make break expand on hover
                var hoverState = axisBreak.states.create("hover");
                hoverState.properties.breakSize = 1;
                hoverState.properties.opacity = 0.1;
                hoverState.transitionDuration = 1500;

                axisBreak.defaultState.transitionDuration = 1000;
                /*
                 // this is exactly the same, but with events
                 axisBreak.events.on("over", function() {
                 axisBreak.animate(
                 [{ property: "breakSize", to: 1 }, { property: "opacity", to: 0.1 }],
                 1500,
                 am4core.ease.sinOut
                 );
                 });
                 axisBreak.events.on("out", function() {
                 axisBreak.animate(
                 [{ property: "breakSize", to: 0.005 }, { property: "opacity", to: 1 }],
                 1000,
                 am4core.ease.quadOut
                 );
                 });*/

                var series = chart.series.push(new am4charts.ColumnSeries());
                series.dataFields.categoryX = "type";
                series.dataFields.valueY = "count";
                series.columns.template.tooltipText = "{valueY.value}";
                series.columns.template.tooltipY = 0;
                series.columns.template.strokeOpacity = 0;

                // as by default columns of the same series are of the same color, we add adapter which takes colors from chart.colors color set
                series.columns.template.adapter.add("fill", function (fill, target) {
                    return chart.colors.getIndex(target.dataItem.index);
                });

                $.ajax({
                    type: "POST",
                    async: false,
                    url: "/index/health/getChartsData",
                    data: {},
                    dataType: "json",
                    success: function (data, status) {
                        console.log(data.data);

                        chart.data = data.data;

                    },
                    error: function (err, ms) {
                        errCallback && errCallback(err);
                    }
                });


                $("#dateSelect").click(function () {
                    dateRange = $("#dateRange").val();
                    $.ajax({
                        type: "POST",
                        async: false,
                        url: "/index/health/getChartsData",
                        data: {datetime: dateRange},
                        dataType: "json",
                        success: function (data, status) {
                            console.log(data.data);

                            chart.data = data.data;

                        },
                        error: function (err, ms) {
                            errCallback && errCallback(err);
                        }
                    });
                });
            }); // end am4core.ready()
        </script>
        <!--begin::Page Scripts(used by this page) -->
        <script src="/static/admin/js/pages/dashboard.js" type="text/javascript"></script>
        <script>
            ajaxpost = function (url, params, callback, errCallback, async) {
                async = (async == 1) ? false : true;
                $.ajax({
                    type: "POST",
                    async: true,
                    url: url,
                    data: params,
                    dataType: "json",
                    success: function (data, status) {
                        callback(data);
                    },
                    error: function (err, ms) {
                        errCallback && errCallback(err);
                    }
                });
            };


            $('#dateRange').daterangepicker({
                buttonClasses: ' btn',
                applyClass: 'btn-primary',
                cancelClass: 'btn-secondary',
                timePicker24Hour: true,

                timePicker: true,
                timePickerIncrement: 30,
                locale: {
                    format: 'YYYY-MM-DD HH:mm',
                    "applyLabel": "确定",
                    "cancelLabel": "取消",
                    "fromLabel": "起始时间",
                    "toLabel": "结束时间'",
                    "customRangeLabel": "自定义",
                    "weekLabel": "W",
                    "daysOfWeek": ["日", "一", "二", "三", "四", "五", "六"],
                    "monthNames": ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
                }
            }, function (start, end, label) {
                $('#dateRange .form-control').val(start.format('YYYY-MM-DD HH:mm') + ' - ' + end.format('YYYY-MM-DD HH:mm'));
            });

            function updateInfo() {
                setInterval(function () {
                    $.ajax({
                        type: "POST",
                        async: true,
                        url: "/index/health/getInfo",
                        data: {},
                        dataType: "json",
                        success: function (data, status) {
                            console.log(data)
                            $("#action_count").text(data.data.count)
                            if (data.data.now != null) {
                                $("#now_action").text(data.data.now.type)
                            } else {
                                $("#now_action").text("Nothing")
                            }
                            if (data.data.last != null) {

                                $("#last_action").text(data.data.last.type)
                            }
                        },
                        error: function (err, ms) {
                            errCallback && errCallback(err);
                        }
                    });
                }, 2000)
            }
            updateInfo();
        </script>
        <!--end::Page Scripts -->
    </body>

    <!-- end::Body -->
</html>